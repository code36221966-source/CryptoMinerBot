<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Miner</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- THEME & COLORS --- */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            margin: 0; padding: 20px;
        }
        
        /* --- BUTTONS --- */
        .btn-main {
            width: 100%; padding: 16px; margin: 10px 0;
            font-size: 18px; font-weight: bold;
            border: none; border-radius: 12px;
            cursor: pointer; transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.98); }
        
        .btn-orange { background-color: #F7931A; color: white; } /* Bitcoin Color */
        .btn-dark   { background-color: #333; color: white; border: 1px solid #555; }
        .btn-blue   { background-color: #0088cc; color: white; } /* Telegram Blue */

        /* --- INPUTS --- */
        input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background: #1e1e1e; border: 1px solid #333; color: white;
            border-radius: 8px; box-sizing: border-box; font-size: 16px;
        }

        /* --- LAYOUT --- */
        .hidden { display: none; }
        .logo { font-size: 60px; margin-bottom: 10px; display: block; }
        .back-link { color: #888; margin-top: 20px; display: block; cursor: pointer; font-size: 14px; }
        
        /* --- DASHBOARD SPECIFIC --- */
        .balance-card {
            background: linear-gradient(145deg, #1e1e1e, #252525);
            padding: 25px; border-radius: 20px;
            margin-bottom: 30px; border: 1px solid #333;
        }
        .coin-anim { font-size: 80px; margin: 20px 0; display: inline-block; }
    </style>
</head>
<body>

    <!-- 1. HOME PAGE -->
    <div id="page-home">
        <br><br>
        <span class="logo">‚õèÔ∏è</span>
        <h1>CryptoMiner</h1>
        <p style="color:#aaa; margin-bottom:40px;">Welcome to the future.</p>
        
        <button class="btn-main btn-orange" onclick="navTo('register')">Create Account</button>
        <button class="btn-main btn-dark" onclick="navTo('login')">Log In</button>
    </div>

    <!-- 2. REGISTER PAGE -->
    <div id="page-register" class="hidden">
        <h1>üìù Register</h1>
        <br>
        <input type="text" id="reg-username" placeholder="Choose Username">
        <input type="email" id="reg-email" placeholder="Email Address">
        <input type="password" id="reg-pass" placeholder="Password">
        
        <button class="btn-main btn-orange" onclick="doRegister()">Sign Up</button>
        <span class="back-link" onclick="navTo('home')">‚¨ÖÔ∏è Back</span>
    </div>

    <!-- 3. LOGIN PAGE -->
    <div id="page-login" class="hidden">
        <h1>üîë Log In</h1>
        <br>
        <input type="text" id="login-username" placeholder="Username">
        <input type="password" id="login-pass" placeholder="Password">
        
        <button class="btn-main btn-orange" onclick="doLogin()">Enter App</button>
        <span class="back-link" onclick="navTo('home')">‚¨ÖÔ∏è Back</span>
    </div>

    <!-- 4. DASHBOARD (AFTER LOGIN) -->
    <div id="page-dashboard" class="hidden">
        <div class="balance-card">
            <span style="color:#aaa; font-size:14px;">MINING BALANCE</span>
            <h1 style="font-size:40px; margin:10px 0; color:#4caf50;" id="display-balance">0.0000</h1>
        </div>

        <div class="coin-anim">ü™ô</div>
        <br>
        <button class="btn-main btn-blue" onclick="alert('Mining function coming in next update!')">‚õèÔ∏è START MINING</button>
        <p style="color:#555; font-size:12px; margin-top:30px;">Logged in as <span id="user-name-display">User</span></p>
    </div>

    <script>
        // --- NAVIGATION LOGIC ---
        window.Telegram.WebApp.expand();

        function navTo(pageId) {
            // Hide all pages
            ['home', 'register', 'login', 'dashboard'].forEach(id => {
                document.getElementById('page-' + id).classList.add('hidden');
            });
            // Show target
            document.getElementById('page-' + pageId).classList.remove('hidden');
        }

        // --- API LOGIC ---

        async function doRegister() {
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;

            if(!username || !password) return alert("Please fill in all fields");

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, email, password})
                });
                const data = await res.json();
                alert(data.message);
                if(data.success) navTo('login');
            } catch(e) {
                alert("Error connecting to server.");
            }
        }

        async function doLogin() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-pass').value;

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password})
                });
                const data = await res.json();

                if(data.success) {
                    // Login Success! Show Dashboard
                    navTo('dashboard');
                    document.getElementById('user-name-display').innerText = data.user.username;
                    document.getElementById('display-balance').innerText = data.user.mining_balance.toFixed(4);
                } else {
                    alert(data.message);
                }
            } catch(e) {
                alert("Error connecting to server.");
            }
        }
    </script>
</body>
</html>
